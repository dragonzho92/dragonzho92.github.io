<!DOCTYPE html>












  


<html class="theme-next gemini use-motion" lang="en">
<head><meta name="generator" content="Hexo 3.9.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">












  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png?v=7.2.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=7.2.0">


  <link rel="mask-icon" href="/images/logo.svg?v=7.2.0" color="#222">






<link rel="stylesheet" href="/css/main.css?v=7.2.0">






<link rel="stylesheet" href="/lib/font-awesome/css/font-awesome.min.css?v=4.7.0">








<script id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Gemini',
    version: '7.2.0',
    sidebar: {"position":"left","display":"post","offset":12,"onmobile":false},
    back2top: {"enable":true,"sidebar":false,"scrollpercent":false},
    copycode: {"enable":false,"show_result":false,"style":null},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    },
    translation: {
      copy_button: 'Copy',
      copy_success: 'Copied',
      copy_failure: 'Copy failed'
    }
  };
</script>

  <meta name="description" content="Insist on maintenance, start a new world">
<meta property="og:type" content="website">
<meta property="og:title" content="Pointing into the distance">
<meta property="og:url" content="https://dragonzho92.github.io/index.html">
<meta property="og:site_name" content="Pointing into the distance">
<meta property="og:description" content="Insist on maintenance, start a new world">
<meta property="og:locale" content="en">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Pointing into the distance">
<meta name="twitter:description" content="Insist on maintenance, start a new world">





  
  
  <link rel="canonical" href="https://dragonzho92.github.io/">



<script id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  
  <title>Pointing into the distance</title>
  












  <noscript>
  <style>
  .use-motion .motion-element,
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-title { opacity: initial; }

  .use-motion .logo,
  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage" lang="en">

  
  
    
  

  <div class="container sidebar-position-left 
  page-home">
    <div class="headband"></div>

    <header id="header" class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Pointing into the distance</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="Toggle navigation bar">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home menu-item-active">

    
    
      
    

    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>Home</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
      
    

    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>Archives</a>

  </li>

      
      
    </ul>
  

  

  
</nav>



</div>
    </header>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            
  <section id="posts" class="posts-expand">
    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/cache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/cache/" class="post-title-link" itemprop="url">常用缓存整理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:04:05" itemprop="dateCreated datePublished" datetime="2018-10-26T09:04:05+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:55:17" itemprop="dateModified" datetime="2019-07-21T00:55:17+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="memcached和redis"><a href="#memcached和redis" class="headerlink" title="memcached和redis"></a>memcached和redis</h2><p><a href="https://mp.weixin.qq.com/s/4vr7bkgqfOisiKmc9q1LEw" target="_blank" rel="noopener">https://mp.weixin.qq.com/s/4vr7bkgqfOisiKmc9q1LEw</a></p>
<p>memcached 是多线程，非阻塞 IO 复用的网络模型，分为监听主线程和 worker子线程，监听线程监听网络连接，接受请求后，将连接描述字 pipe 传递给 worker 线程，进行读写 IO。</p>
<p>网络层使用 <code>libevent</code>封装的事件库，多线程模型可以发挥多核作用，但是引入了<code>cache coherency</code> 和锁的问题，比如：memcached 最常用的 stats 命令，实际 memcached 所有操作都要对这个全局变量加锁，进行技术等工作，带来了性能损耗。</p>
<p>redis 使用单线程的 IO 复用模型，自己封装了一个简单的 AeEvent 事件处理框架，主要实现了 epoll, kqueue 和 select，对于单存只有 IO 操作来说，单线程可以将速度优势发挥到最大。</p>
<p>但是 redis 也提供了一些简单的计算功能，比如排序、聚合等，对于这些操作，单线程模型施加会严重影响整体吞吐量，CPU 计算过程中，整个 IO 调度都是被阻塞的。</p>
<h2 id="缓存实现方式"><a href="#缓存实现方式" class="headerlink" title="缓存实现方式"></a>缓存实现方式</h2><h3 id="本地缓存"><a href="#本地缓存" class="headerlink" title="本地缓存"></a>本地缓存</h3><ol>
<li><p>编程实现</p>
<blockquote>
<p>局部变量，成员变量</p>
<p>静态变量：结合zk做实时性刷新（GC、实时性差、数据量小）</p>
</blockquote>
</li>
<li><p>encache</p>
</li>
<li><p>Guava Cache</p>
</li>
</ol>
<h3 id="分布式缓存"><a href="#分布式缓存" class="headerlink" title="分布式缓存"></a>分布式缓存</h3><ol>
<li>memcached</li>
<li>redis</li>
</ol>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/序列化的实现/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/序列化的实现/" class="post-title-link" itemprop="url">序列化的实现</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:04:05" itemprop="dateCreated datePublished" datetime="2018-10-26T09:04:05+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:45:47" itemprop="dateModified" datetime="2019-07-21T00:45:47+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="序列化"><a href="#序列化" class="headerlink" title="序列化"></a>序列化</h2><ol>
<li><p>transient避免序列化</p>
</li>
<li><p>手动序列化：在实现了Serializable接口的类中添加两个私有的方法writeObject()和readObject()，在这两个方法中控制字段的序列化</p>
<blockquote>
<p>不能关闭流</p>
</blockquote>
</li>
</ol>
   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">writeObject</span><span class="params">(ObjectOutputStream oos)</span><span class="keyword">throws</span> IOException</span>&#123;</span><br><span class="line">    oos.defaultWriteObject();</span><br><span class="line">    oos.writeObject(password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>实现Externalible接口需要定义一个默认的构造函数，否则将会抛出java.io.InvalidClassException异常</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">public void writeExternal(ObjectOutput out)throws IOException&#123;</span><br><span class="line">    out.writeObject(name);</span><br><span class="line">    out.writeObject(password);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
</li>
<li><p>序列化操作保存的是对象的状态，静态字段是类的状态而不是对象的状态，所以不能序列化</p>
</li>
<li></li>
</ol>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/spring-framework-reference/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/spring-framework-reference/" class="post-title-link" itemprop="url">spring reference 阅读笔记</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:04:05" itemprop="dateCreated datePublished" datetime="2018-10-26T09:04:05+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:39:57" itemprop="dateModified" datetime="2019-07-21T00:39:57+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="core-startup"><a href="#core-startup" class="headerlink" title="core startup"></a>core startup</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">synchronized</span> (<span class="keyword">this</span>.startupShutdownMonitor) &#123;</span><br><span class="line">			<span class="comment">// Prepare this context for refreshing.</span></span><br><span class="line">			prepareRefresh();</span><br><span class="line">			<span class="comment">// Tell the subclass to refresh the internal bean factory.</span></span><br><span class="line">			ConfigurableListableBeanFactory beanFactory = obtainFreshBeanFactory();</span><br><span class="line">			<span class="comment">// Prepare the bean factory for use in this context.</span></span><br><span class="line">			prepareBeanFactory(beanFactory);</span><br><span class="line">			<span class="keyword">try</span> &#123;</span><br><span class="line">				<span class="comment">// Allows post-processing of the bean factory in context subclasses.</span></span><br><span class="line">				postProcessBeanFactory(beanFactory);</span><br><span class="line">				<span class="comment">// Invoke factory processors registered as beans in the context.</span></span><br><span class="line">				invokeBeanFactoryPostProcessors(beanFactory);</span><br><span class="line">				<span class="comment">// Register bean processors that intercept bean creation.</span></span><br><span class="line">				registerBeanPostProcessors(beanFactory);ff</span><br><span class="line">				<span class="comment">// Initialize message source for this context.</span></span><br><span class="line">				initMessageSource();</span><br><span class="line">				<span class="comment">// Initialize event multicaster for this context.</span></span><br><span class="line">				initApplicationEventMulticaster();</span><br><span class="line">				<span class="comment">// Initialize other special beans in specific context subclasses.</span></span><br><span class="line">				onRefresh();</span><br><span class="line">				<span class="comment">// Check for listener beans and register them.</span></span><br><span class="line">				registerListeners();</span><br><span class="line">				<span class="comment">// Instantiate all remaining (non-lazy-init) singletons.</span></span><br><span class="line">				finishBeanFactoryInitialization(beanFactory);</span><br><span class="line">				<span class="comment">// Last step: publish corresponding event.</span></span><br><span class="line">				finishRefresh();</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">catch</span> (BeansException ex) &#123;</span><br><span class="line">				<span class="keyword">if</span> (logger.isWarnEnabled()) &#123;</span><br><span class="line">					logger.warn(<span class="string">"Exception encountered during context initialization - "</span> +</span><br><span class="line">							<span class="string">"cancelling refresh attempt: "</span> + ex);</span><br><span class="line">				&#125;</span><br><span class="line">				<span class="comment">// Destroy already created singletons to avoid dangling resources.</span></span><br><span class="line">				destroyBeans();</span><br><span class="line">				<span class="comment">// Reset 'active' flag.</span></span><br><span class="line">				cancelRefresh(ex);</span><br><span class="line">				<span class="comment">// Propagate exception to caller.</span></span><br><span class="line">				<span class="keyword">throw</span> ex;</span><br><span class="line">			&#125;</span><br><span class="line">			<span class="keyword">finally</span> &#123;</span><br><span class="line">				<span class="comment">// Reset common introspection caches in Spring's core, since we</span></span><br><span class="line">				<span class="comment">// might not ever need metadata for singleton beans anymore...</span></span><br><span class="line">				resetCommonCaches();</span><br><span class="line">			&#125;</span><br><span class="line">		&#125;</span><br></pre></td></tr></table></figure>

<h2 id="The-IOC-Container"><a href="#The-IOC-Container" class="headerlink" title="The IOC Container"></a>The IOC Container</h2><h3 id="Introduction"><a href="#Introduction" class="headerlink" title="Introduction"></a>Introduction</h3><p>The <code>AplicationContext</code> is a sub-class of <code>BeanFactory</code>, it adds easier intregration of spring’s AOP features, message resource manage(internationnal), event publication, application-layer specific contexts.</p>
<p>Bean definitions are represented as <code>BeanDefinition</code> objects, which contain (among other information) the following metadata:</p>
<ul>
<li><strong>A package-qualified class name:</strong> typically the actual implementation *<em>class *</em>of the bean being defined.</li>
<li>Bean behavioral configuration elements, which state how the bean should behave in the container (<strong>scope, lifecycle callbacks</strong>, and so forth).</li>
<li>References to other beans that are needed for the bean to do its work; these references are also called <em>collaborators</em> or <strong>dependencies</strong>.</li>
<li><strong>Other configuration settings</strong> to set in the newly created object, for example, the number of connections to use in a bean that manages a connection pool, or the size limit of the pool.</li>
</ul>
<h2 id="Data-access-with-JDBC"><a href="#Data-access-with-JDBC" class="headerlink" title="Data access with JDBC"></a>Data access with JDBC</h2><h3 id="JDBC-core-control-class"><a href="#JDBC-core-control-class" class="headerlink" title="JDBC core control class"></a>JDBC core control class</h3><h4 id="JdbcTemplate"><a href="#JdbcTemplate" class="headerlink" title="JdbcTemplate"></a>JdbcTemplate</h4><ol>
<li>creation and release of resources</li>
<li>basic tasks work-flow of JDBC, such as statement creation and execution</li>
<li>execute SQL query and update statement and precudure calls, iterate over ‘ResultSet ‘and extract returned parameter values</li>
<li>catch JDBC exception</li>
<li>threadsafe once configured</li>
</ol>
<h2 id="Core-config"><a href="#Core-config" class="headerlink" title="Core config"></a>Core config</h2><ul>
<li>ApplicationListener</li>
<li></li>
</ul>
<h2 id="ORM-Data-Access"><a href="#ORM-Data-Access" class="headerlink" title="ORM Data Access"></a>ORM Data Access</h2><h3 id="JPA"><a href="#JPA" class="headerlink" title="JPA"></a>JPA</h3><ul>
<li></li>
<li>Three ways to set up <code>EntityManagerFactory</code>:<ol>
<li><code>LocalEntityManagerFactoryBean</code> : <ul>
<li>suitable for simple deployment enviroment, and the application only use jpa for data access.</li>
</ul>
</li>
</ol>
</li>
</ul>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/Spring Cache/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/Spring Cache/" class="post-title-link" itemprop="url">spring cache原理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:04:05" itemprop="dateCreated datePublished" datetime="2018-10-26T09:04:05+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:56:25" itemprop="dateModified" datetime="2019-07-21T00:56:25+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h1 id="Spring-Cache"><a href="#Spring-Cache" class="headerlink" title="Spring Cache"></a>Spring Cache</h1><ul>
<li>cache storage is not implemented by Spring, where as enabling and caching is supported by spring out of the box</li>
</ul>
<h2 id="spring-cache-base"><a href="#spring-cache-base" class="headerlink" title="spring cache base"></a>spring cache base</h2><p>spring has a abstract immplemention for the following list:</p>
<ol>
<li><p>JDK <code>java.util.concurrent.ConcurrentMap</code> based caches</p>
<blockquote>
<p> need the Cache manager to be configured and the data stored in the in-memory</p>
</blockquote>
</li>
<li><p>EhCache</p>
<blockquote>
<p>need add the ehcache.xml file in the classpath</p>
</blockquote>
</li>
<li><p><a href="https://javabeat.net/spring-data-gemfire/" target="_blank" rel="noopener">Gemfire Cache</a></p>
</li>
<li><p>Guava Caches</p>
</li>
<li><p>JSR 107 complaint caches</p>
</li>
</ol>
<h2 id="spring-cache-annotation"><a href="#spring-cache-annotation" class="headerlink" title="spring cache annotation"></a>spring cache annotation</h2><ol>
<li><p>@Cacheable</p>
<ul>
<li><p>annotate a method, and request will not execute the method, instead to get result from cache</p>
<blockquote>
<p>cacheManager: bean name of cache manager.</p>
<p><strong>cacheNames</strong>: matching the qualifier value or bean name of a specific bean definition</p>
<p><strong>cacheResolver</strong></p>
<p><strong>condition</strong></p>
</blockquote>
</li>
<li><p>当重复使用相同参数调用方法的时候，方法本身不会被调用执行，即方法本身被略过了，取而代之的是方法的结果直接从缓存中找到并返回了</p>
</li>
</ul>
</li>
<li><p>@CacheEvict</p>
<ul>
<li>clear the cache</li>
</ul>
</li>
<li><p>@CachePut</p>
<ul>
<li>这个注释可以确保方法被执行，同时方法的返回值也被记录到缓存中。</li>
</ul>
</li>
<li><p>@Caching</p>
</li>
<li><p>@CacheConfig</p>
</li>
</ol>
<h2 id="Enable-spring-caching"><a href="#Enable-spring-caching" class="headerlink" title="Enable spring caching"></a>Enable spring caching</h2><ol>
<li><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@EnableCaching</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Application</span> </span>&#123;</span><br></pre></td></tr></table></figure>
</li>
<li><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">"http://www.springframework.org/schema/beans"</span> </span></span><br><span class="line">        &lt;cache:annotation-driven /&gt;</span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span>JCache (JSR – 107) Support</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="JCache-JSR-–-107-Support"><a href="#JCache-JSR-–-107-Support" class="headerlink" title="JCache (JSR – 107) Support"></a>JCache (JSR – 107) Support</h2><table>
<thead>
<tr>
<th>@Cacheable</th>
<th>@CacheResult</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td>@CachePut</td>
<td>@CachePut</td>
<td>There is no change in the annotation name</td>
</tr>
<tr>
<td>@CacheEvict</td>
<td>@CacheRemove</td>
<td>@CacheRemove evicts conditionaly whenthere is exception throw from the method.</td>
</tr>
<tr>
<td>@CacheEvict(allEntries=true)</td>
<td>@CacheRemoveAll</td>
<td>JCache adds another annotation forremoving all the cache entries</td>
</tr>
<tr>
<td>@CacheConfig</td>
<td>@CacheDefaults</td>
<td>Both the annotations work similar</td>
</tr>
</tbody></table>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&lt;bean id=<span class="string">"cacheManager"</span> <span class="class"><span class="keyword">class</span></span>=<span class="string">"org.springframework.cache.jcache.JCacheCacheManager"</span> p:cache-manager-ref=<span class="string">"jCacheManager"</span>/&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- JSR-<span class="number">107</span> cache manager setup --&gt;</span><br><span class="line">&lt;bean id=<span class="string">"jCacheManager"</span> .../&gt;</span><br></pre></td></tr></table></figure>

<h2 id="EhCache-Configuration"><a href="#EhCache-Configuration" class="headerlink" title="EhCache Configuration"></a>EhCache Configuration</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"cacheManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.cache.ehcache.EhCacheCacheManager"</span> <span class="attr">p:cache-manager-ref</span>=<span class="string">"ehcache"</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- EhCache library setup --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"ehcache"</span> <span class="attr">class</span>=<span class="string">"org.springframework.cache.ehcache.EhCacheManagerFactoryBean"</span> <span class="attr">p:config-location</span>=<span class="string">"ehcache.xml"</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>or</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CacheManager <span class="title">ehCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> EhCacheCacheManager(ehCacheCacheManager().getObject());</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> EhCacheManagerFactoryBean <span class="title">ehCacheCacheManager</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	EhCacheManagerFactoryBean cmfb = <span class="keyword">new</span> EhCacheManagerFactoryBean();</span><br><span class="line">	cmfb.setConfigLocation(<span class="keyword">new</span> ClassPathResource(<span class="string">"ehcache.xml"</span>));</span><br><span class="line">	cmfb.setShared(<span class="keyword">true</span>);</span><br><span class="line">	<span class="keyword">return</span> cmfb;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>ehcache.xml</code></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">ehcache</span> <span class="attr">xmlns:xsi</span>=<span class="string">"http://www.w3.org/2001/XMLSchema-instance"</span> <span class="attr">xsi:noNamespaceSchemaLocation</span>=<span class="string">"ehcache.xsd"</span> <span class="attr">updateCheck</span>=<span class="string">"true"</span> <span class="attr">monitoring</span>=<span class="string">"autodetect"</span> <span class="attr">dynamicConfig</span>=<span class="string">"true"</span>&gt;</span></span><br><span class="line"></span><br><span class="line">	<span class="tag">&lt;<span class="name">diskStore</span> <span class="attr">path</span>=<span class="string">"java.io.tmpdir"</span> /&gt;</span></span><br><span class="line">	</span><br><span class="line">	<span class="tag">&lt;<span class="name">cache</span> <span class="attr">name</span>=<span class="string">"movieFindCache"</span> <span class="attr">maxEntriesLocalHeap</span>=<span class="string">"10000"</span> <span class="attr">maxEntriesLocalDisk</span>=<span class="string">"1000"</span> <span class="attr">eternal</span>=<span class="string">"false"</span> <span class="attr">diskSpoolBufferSizeMB</span>=<span class="string">"20"</span> <span class="attr">timeToIdleSeconds</span>=<span class="string">"300"</span> <span class="attr">timeToLiveSeconds</span>=<span class="string">"600"</span> <span class="attr">memoryStoreEvictionPolicy</span>=<span class="string">"LFU"</span> <span class="attr">transactionalMode</span>=<span class="string">"off"</span>&gt;</span></span><br><span class="line">		<span class="tag">&lt;<span class="name">persistence</span> <span class="attr">strategy</span>=<span class="string">"localTempSwap"</span> /&gt;</span></span><br><span class="line">	<span class="tag">&lt;/<span class="name">cache</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">ehcache</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Cache-Fallback-Mechanism"><a href="#Cache-Fallback-Mechanism" class="headerlink" title="Cache Fallback Mechanism"></a>Cache Fallback Mechanism</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">"cacheManager"</span> <span class="attr">class</span>=<span class="string">"org.springframework.cache.support.CompositeCacheManager"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"cacheManagers"</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"jdkCache"</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">ref</span> <span class="attr">bean</span>=<span class="string">"ehCache"</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"fallbackToNoOpCache"</span> <span class="attr">value</span>=<span class="string">"true"</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Spring-Boot-Application"><a href="#Spring-Boot-Application" class="headerlink" title="Spring Boot Application"></a>Spring Boot Application</h2><p>​    Spring Boot Auto Configuration Support -&gt; <strong>Update: After the release of Spring Boot 1.3.0</strong></p>
<p>list of caching technologies supported as of now</p>
<ul>
<li><a href="https://javabeat.net/ehcache/" target="_blank" rel="noopener">EhCache</a></li>
<li>Hazelcast</li>
<li>Infinispan</li>
<li>Any JCache (JSR 107) implementation</li>
<li><a href="https://javabeat.net/spring-data-redis-example/" target="_blank" rel="noopener">Redis</a></li>
<li>Guava</li>
<li>Simple Map based in-memory cache also supported in the auto configuration</li>
</ul>
<h2 id="Exceptions"><a href="#Exceptions" class="headerlink" title="Exceptions"></a>Exceptions</h2><p>This section shows some of the common error or exceptions that are encountered while developing this application. If you see any other issues, please write it in the comments section.</p>
<h3 id="CacheManager-Registration-Problem"><a href="#CacheManager-Registration-Problem" class="headerlink" title="CacheManager Registration Problem:"></a><strong>CacheManager Registration Problem:</strong></h3><p>** **The below exception will be thrown when you have enabled caching functionality and not configured any of the cache manager. You should have atleast one cache manager to store the incoming catches.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">Exception in thread &quot;main&quot; java.lang.IllegalStateException: No CacheResolver specified, and no bean of type CacheManager found. Register a CacheManager bean or remove the @EnableCaching annotation from your configuration.</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.afterSingletonsInstantiated(CacheAspectSupport.java:189)</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:775)</span><br><span class="line">	at org.springframework.context.support.AbstractApplicationContext.finishBeanFactoryInitialization(AbstractApplicationContext.java:757)</span><br><span class="line">	at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:480)</span><br></pre></td></tr></table></figure>

<h3 id="Cache-Manager-Name-Problem"><a href="#Cache-Manager-Name-Problem" class="headerlink" title="*Cache Manager Name Problem: *"></a>*<em>Cache Manager Name Problem: *</em></h3><p>When you are not specifying the cache name in the cache manager and you are trying to use it in the @Cacheable annotation. For example look at the following entry:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Cacheable(value=&quot;users1&quot;)</span><br><span class="line">	public UserDetails findById(String id) &#123;</span><br><span class="line">		slowResponsee();</span><br><span class="line">		return new UserDetails(id, &quot;Name&quot;+id);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>

<p>In the above code, it tries to search for the cache manager with the name of “users”, if it is not finding then it will throw the below exception.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">Caused by: java.lang.IllegalArgumentException: Cannot find cache named &apos;users1&apos; for CacheableOperation[public net.javabeat.spring.cache.UserDetails net.javabeat.spring.cache.UserRepositoryImpl.findById(java.lang.String)] caches=[users1] | key=&apos;&apos; | keyGenerator=&apos;&apos; | cacheManager=&apos;&apos; | cacheResolver=&apos;&apos; | condition=&apos;&apos; | unless=&apos;&apos;</span><br><span class="line">	at org.springframework.cache.interceptor.AbstractCacheResolver.resolveCaches(AbstractCacheResolver.java:81)</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.getCaches(CacheAspectSupport.java:214)</span><br></pre></td></tr></table></figure>

<h3 id="Primary-or-Declare-a-Specific-CacheManager-Exception"><a href="#Primary-or-Declare-a-Specific-CacheManager-Exception" class="headerlink" title="Primary or Declare a Specific CacheManager Exception"></a><strong>Primary or Declare a Specific CacheManager Exception</strong></h3><p>In the above code, we have declaraed JDK cache and EhCache for our applications. But, if the application could not find any of these stores, then we have configured <code>fallbackToNoOpCache</code> to execute methods without any exceptions thrown at runtime.</p>
<p>When you are declaring more than one cache managers in your application, your application may not be able to resolve which cache manager has to be used for the annotation not using the <code>cacheManager</code> attribute to specify the cache manager name. In that case, you would encounter the following exception.</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">java.lang.IllegalStateException: No CacheResolver specified, and no unique bean of type CacheManager found. Mark one as primary or declare a specific CacheManager to use.</span><br><span class="line">	at org.springframework.cache.interceptor.CacheAspectSupport.afterSingletonsInstantiated(CacheAspectSupport.java:185)</span><br><span class="line">	at org.springframework.beans.factory.support.DefaultListableBeanFactory.preInstantiateSingletons(DefaultListableBeanFactory.java:775)</span><br></pre></td></tr></table></figure>

<p>The above problem can be resolved by making one of the cache manager as the primary by annotating as <code>@Primary</code> as below:</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">@Primary</span><br><span class="line">	@Bean</span><br><span class="line">	public CacheManager jdkCacheManager() &#123;</span><br><span class="line">		return new ConcurrentMapCacheManager(&quot;users&quot;);</span><br><span class="line">	&#125;</span><br></pre></td></tr></table></figure>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/Mybatis数据库连接/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/Mybatis数据库连接/" class="post-title-link" itemprop="url">mybatis基本原理和动态SQL</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:03:50" itemprop="dateCreated datePublished" datetime="2018-10-26T09:03:50+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:58:32" itemprop="dateModified" datetime="2019-07-21T00:58:32+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="mybatis数据库连接"><a href="#mybatis数据库连接" class="headerlink" title="mybatis数据库连接"></a>mybatis数据库连接</h2><h3 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h3><h4 id="一级缓存"><a href="#一级缓存" class="headerlink" title="一级缓存"></a>一级缓存</h4><p>​    基于PerpetualCache 的 HashMap本地缓存，其存储作用域为 Session，当 Session flush 或 close 之后，该Session中的所有 Cache 就将清空。（默认开启）</p>
<h4 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h4><p>​    二级缓存与一级缓存其机制相同，默认也是采用 PerpetualCache，HashMap存储，不同在于其存储作用域为 Mapper(Namespace)，并且可自定义存储源，如 Ehcache。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">（<span class="comment">&lt;!-- 开启二级缓存 --&gt;</span><span class="tag">&lt;<span class="name">cache</span>&gt;</span><span class="tag">&lt;/<span class="name">cache</span>&gt;</span>）</span><br></pre></td></tr></table></figure>

<h5 id="二级缓存补充说明"><a href="#二级缓存补充说明" class="headerlink" title="二级缓存补充说明"></a>二级缓存补充说明</h5><pre><code>1. 映射语句文件中的所有select语句将会被缓存。　
2. 映射语句文件中的所有insert，update和delete语句会刷新缓存。　
3. 缓存会使用Least Recently Used（LRU，最近最少使用的）算法来收回。　
4. 缓存会根据指定的时间间隔来刷新。
5. 缓存会存储1024个对象cache标签常用属性：
6. cache标签常用属性：</code></pre><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">cache</span></span></span><br><span class="line">eviction="FIFO" &lt;!--回收策略为先进先出--&gt;</span><br><span class="line">flushInterval="60000" <span class="comment">&lt;!--自动刷新时间60s--&gt;</span></span><br><span class="line">size="512" <span class="comment">&lt;!--最多缓存512个引用对象--&gt;</span></span><br><span class="line">readOnly="true"/&gt; <span class="comment">&lt;!--只读--&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="缓存数据更新机制"><a href="#缓存数据更新机制" class="headerlink" title="缓存数据更新机制"></a>缓存数据更新机制</h4><p>​    当某一个作用域(一级缓存Session/二级缓存Namespaces)的进行了 C/U/D 操作后，默认该作用域下所有 select 中的缓存将被clear。</p>
<h3 id="动态sql"><a href="#动态sql" class="headerlink" title="动态sql"></a>动态sql</h3><h4 id="selectKey"><a href="#selectKey" class="headerlink" title="selectKey"></a>selectKey</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 插入学生 自动主键--&gt;</span>  </span><br><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">"createStudentAutoKey"</span> <span class="attr">parameterType</span>=<span class="string">"liming.student.manager.data.model.StudentEntity"</span> <span class="attr">keyProperty</span>=<span class="string">"studentId"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">selectKey</span> <span class="attr">keyProperty</span>=<span class="string">"studentId"</span> <span class="attr">resultType</span>=<span class="string">"String"</span> <span class="attr">order</span>=<span class="string">"BEFORE"</span>&gt;</span>  </span><br><span class="line">        select nextval('student')  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">selectKey</span>&gt;</span>  </span><br><span class="line">    INSERT INTO STUDENT_TBL(STUDENT_ID, STUDENT_NAME, STUDENT_SEX, STUDENT_BIRTHDAY, 				STUDENT_PHOTO, CLASS_ID, PLACE_ID)  </span><br><span class="line">    	VALUES (#&#123;studentId&#125;, #&#123;studentName&#125;, #&#123;studentSex&#125;, #&#123;studentBirthday&#125;, #					&#123;studentPhoto, javaType=byte[], jdbcType=BLOB,				    typeHandler=org.apache.ibatis.type.BlobTypeHandler&#125;, #&#123;classId&#125;,  #&#123;placeId&#125;)  </span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>keyProperty</th>
<th>selectKey 语句生成结果需要设置的属性。</th>
</tr>
</thead>
<tbody><tr>
<td>resultType</td>
<td>生成结果类型，MyBatis 允许使用基本的数据类型，包括String 、int类型。</td>
</tr>
<tr>
<td>order</td>
<td>1：BEFORE，会先选择主键，然后设置keyProperty，再执行insert语句；                          2：AFTER，就先运行insert 语句再运行selectKey 语句。</td>
</tr>
<tr>
<td>statementType</td>
<td>MyBatis 支持STATEMENT，PREPARED和CALLABLE 的语句形式， 对应Statement ，PreparedStatement 和CallableStatement 响应</td>
</tr>
</tbody></table>
<h4 id="if标签"><a href="#if标签" class="headerlink" title="if标签"></a>if标签</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">if</span> <span class="attr">test</span>=<span class="string">"studentName !=null "</span>&gt;</span>  </span><br><span class="line">     ST.STUDENT_NAME LIKE CONCAT(CONCAT('%', #&#123;studentName, jdbcType=VARCHAR&#125;),'%')  </span><br><span class="line"><span class="tag">&lt;/<span class="name">if</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="trim"><a href="#trim" class="headerlink" title="trim"></a>trim</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">trim</span> <span class="attr">prefix</span>=<span class="string">"WHERE"</span> <span class="attr">prefixOverrides</span>=<span class="string">"AND|OR"</span>&gt;</span></span><br><span class="line">  .............</span><br><span class="line"><span class="tag">&lt;/<span class="name">trim</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="choose"><a href="#choose" class="headerlink" title="choose"></a>choose</h4><p>​    choose标签是按顺序判断其内部when标签中的test条件出否成立，如果有一个成立，则choose结束。当choose中所有when的条件都不满则时，则执行otherwise中的sql。类似于Java 的switch 语句，choose为switch，when为case，otherwise则为default。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">where</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;<span class="name">choose</span>&gt;</span>  </span><br><span class="line">           <span class="tag">&lt;<span class="name">when</span> <span class="attr">test</span>=<span class="string">"studentName !=null "</span>&gt;</span>  </span><br><span class="line">               ST.STUDENT_NAME LIKE CONCAT(CONCAT('%', #&#123;studentName, jdbcType=VARCHAR&#125;),'%')  </span><br><span class="line">           <span class="tag">&lt;/<span class="name">when</span> &gt;</span>  </span><br><span class="line">           <span class="tag">&lt;<span class="name">otherwise</span>&gt;</span>  </span><br><span class="line">           <span class="tag">&lt;/<span class="name">otherwise</span>&gt;</span>  </span><br><span class="line">       <span class="tag">&lt;/<span class="name">choose</span>&gt;</span>  </span><br><span class="line">   <span class="tag">&lt;/<span class="name">where</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">foreach</span> <span class="attr">collection</span>=<span class="string">"list/array/传入map的key"</span> <span class="attr">item</span>=<span class="string">"classIdList"</span>  <span class="attr">open</span>=<span class="string">"("</span> <span class="attr">separator</span>=<span class="string">","</span> <span class="attr">close</span>=<span class="string">")"</span>&gt;</span>  </span><br><span class="line">       #&#123;classIdList&#125;  </span><br><span class="line">    <span class="tag">&lt;/<span class="name">foreach</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>​    MyBatis会自动将传入值包装在一个Map中，用名称在作为键。List实例将会以“list”作为键，而数组实例将会以“array”作为键。</p>
<h3 id="配置文件标签"><a href="#配置文件标签" class="headerlink" title="配置文件标签"></a>配置文件标签</h3><h4 id="properties"><a href="#properties" class="headerlink" title="properties"></a>properties</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span> <span class="attr">resource</span>=<span class="string">"mysql.properties"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbc.driverClassName"</span> <span class="attr">value</span>=<span class="string">"com.mysql.jdbc.Driver"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"jdbc.url"</span> <span class="attr">value</span>=<span class="string">"jdbc:mysql://localhost:3306/student_manager"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"username"</span> <span class="attr">value</span>=<span class="string">"root"</span>/&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"password"</span> <span class="attr">value</span>=<span class="string">"123456"</span>/&gt;</span> </span><br><span class="line">  	<span class="comment">&lt;!--&lt;property name="password" value="$&#123;password&#125;"/&gt;  --&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span> //替换和使用配置文件属性</span><br></pre></td></tr></table></figure>

<h4 id="settings"><a href="#settings" class="headerlink" title="settings"></a>settings</h4><table>
<thead>
<tr>
<th>设置项</th>
<th>描述</th>
<th>允许值</th>
<th>默认值</th>
</tr>
</thead>
<tbody><tr>
<td>cacheEnabled</td>
<td>对在此配置文件下的所有cache 进行全局性开/关设置。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>lazyLoadingEnabled</td>
<td>全局性设置懒加载。如果设为‘false’，则所有相关联的都会被初始化加载。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>aggressiveLazyLoading</td>
<td>当设置为‘true’的时候，懒加载的对象可能被任何懒属性全部加载。否则，每个属性都按需加载。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>multipleResultSetsEnabled</td>
<td>允许和不允许单条语句返回多个数据集（取决于驱动需求）</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>useColumnLabel</td>
<td>使用列标签代替列名称。不同的驱动器有不同的作法。参考一下驱动器文档，或者用这两个不同的选项进行测试一下。</td>
<td>true | false</td>
<td>true</td>
</tr>
<tr>
<td>useGeneratedKeys</td>
<td>允许JDBC 生成主键。需要驱动器支持。如果设为了true，这个设置将强制使用被生成的主键，有一些驱动器不兼容不过仍然可以执行。</td>
<td>true | false</td>
<td>false</td>
</tr>
<tr>
<td>autoMappingBehavior</td>
<td>指定MyBatis 是否并且如何来自动映射数据表字段与对象的属性。PARTIAL将只自动映射简单的，没有嵌套的结果。FULL 将自动映射所有复杂的结果。</td>
<td>NONE,PARTIAL,FULL</td>
<td>PARTIAL</td>
</tr>
<tr>
<td>defaultExecutorType</td>
<td>配置和设定执行器，SIMPLE 执行器执行其它语句。REUSE 执行器可能重复使用prepared statements 语句，BATCH执行器可以重复执行语句和批量更新。</td>
<td>SIMPLEREUSEBATCH</td>
<td>SIMPLE</td>
</tr>
<tr>
<td>defaultStatementTimeout</td>
<td>设置一个时限，以决定让驱动器等待数据库回应的多长时间为超时</td>
<td>正整数</td>
<td>Not Set(null)</td>
</tr>
<tr>
<td>logImpl</td>
<td>配置使用的日志插件</td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h4 id="typeAliases"><a href="#typeAliases" class="headerlink" title="typeAliases"></a>typeAliases</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">"DBLOG"</span> <span class="attr">type</span>=<span class="string">"**.DBLogger"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="typeHandlers"><a href="#typeHandlers" class="headerlink" title="typeHandlers"></a>typeHandlers</h4><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LimingStringTypeHandler</span> <span class="keyword">implements</span> <span class="title">TypeHandler</span> </span>&#123;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, Object parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;    </span><br><span class="line">        ps.setString(i, ((String) parameter));  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException </span>&#123;   </span><br><span class="line">        <span class="keyword">return</span> rs.getString(columnName);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">getResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException </span>&#123;   </span><br><span class="line">        <span class="keyword">return</span> cs.getString(columnIndex);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">javaType</span>=<span class="string">"String"</span> <span class="attr">jdbcType</span>=<span class="string">"VARCHAR"</span> <span class="attr">handler</span>=<span class="string">"**.LimingStringTypeHandler"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="ObjectFactory"><a href="#ObjectFactory" class="headerlink" title="ObjectFactory"></a>ObjectFactory</h4><p>​    每次MyBatis 为结果对象创建一个新实例，都会用到ObjectFactory。默认的ObjectFactory 与使用目标类的构造函数创建一个实例毫无区别，如果有已经映射的参数，那也可能使用带参数的构造函数。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LimingObjectFactory</span> <span class="keyword">extends</span> <span class="title">DefaultObjectFactory</span> </span>&#123; </span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = -<span class="number">399284318168302833L</span>;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class type)</span> </span>&#123;  </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">super</span>.create(type);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">create</span><span class="params">(Class type, List&lt;Class&gt; constructorArgTypes, List&lt;Object&gt; constructorArgs)</span> </span>&#123;  </span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">super</span>.create(type, constructorArgTypes, constructorArgs);  </span><br><span class="line">    &#125;  </span><br><span class="line">    <span class="meta">@Override</span>  </span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setProperties</span><span class="params">(Properties properties)</span> </span>&#123; </span><br><span class="line">        <span class="keyword">super</span>.setProperties(properties);  </span><br><span class="line">    &#125;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">objectFactory</span> <span class="attr">type</span>=<span class="string">"liming.student.manager.configuration.LimingObjectFactory"</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">"someProperty"</span> <span class="attr">value</span>=<span class="string">"100"</span>/&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">objectFactory</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="plugins"><a href="#plugins" class="headerlink" title="plugins"></a>plugins</h4><p>MyBatis允许你在某一点拦截已映射语句执行的调用。默认情况下，MyBatis允许使用插件来拦截方法调用：</p>
<ul>
<li>Executor(update, query, flushStatements, commit, rollback, getTransaction, close, isClosed)</li>
<li>ParameterHandler(getParameterObject, setParameters)</li>
<li>ResultSetHandler(handleResultSets, handleOutputParameters)</li>
<li>StatementHandler(prepare, parameterize, batch, update, query)</li>
</ul>
<h4 id="environments"><a href="#environments" class="headerlink" title="environments"></a>environments</h4><ul>
<li><p>MyBatis 可以配置多个环境。这可以帮助你SQL 映射对应多种数据库等。</p>
</li>
<li><p>可以配置transactionManager、dataSource等</p>
</li>
</ul>
<h4 id="mappers"><a href="#mappers" class="headerlink" title="mappers"></a>mappers</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mappers</span>&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/manager/data/maps/UserMapper.xml"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/manager/data/maps/StudentMapper.xml"</span> /&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">"com/manager/data/maps/ClassMapper.xml"</span> /&gt;</span>  </span><br><span class="line"><span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="扩展Dao层"><a href="#扩展Dao层" class="headerlink" title="扩展Dao层"></a>扩展Dao层</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//实现自己的dao接口并且继承SqlSessionDaoSupport，使用getSqlSession()获取SqlSessionTemplate来执行SQL</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">UserDAOImpl</span> <span class="keyword">extends</span> <span class="title">SqlSessionDaoSupport</span> <span class="keyword">implements</span> <span class="title">UserDAO</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Article&gt; <span class="title">getUserArticles</span><span class="params">(<span class="keyword">int</span> userid)</span> </span>&#123;        </span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.getSqlSession().selectList(<span class="string">"com.yihaomen.inter.IUserOperation.getUserArticles"</span>,userid);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="从JDBC到Mybatis"><a href="#从JDBC到Mybatis" class="headerlink" title="从JDBC到Mybatis"></a><a href="http://www.cnblogs.com/jeffen/p/6248999.html" target="_blank" rel="noopener">从JDBC到Mybatis</a></h3><h2 id="问题："><a href="#问题：" class="headerlink" title="问题："></a><strong><code>问题：</code></strong></h2><h3 id="1-mybatis里面大量的代理是如何处理的？"><a href="#1-mybatis里面大量的代理是如何处理的？" class="headerlink" title="1. mybatis里面大量的代理是如何处理的？"></a>1. mybatis里面大量的代理是如何处理的？</h3><h3 id="2-session是如何管理的？生命周期？"><a href="#2-session是如何管理的？生命周期？" class="headerlink" title="2. session是如何管理的？生命周期？"></a>2. session是如何管理的？生命周期？</h3><h3 id="3-如何对接其他的数据源？"><a href="#3-如何对接其他的数据源？" class="headerlink" title="3. 如何对接其他的数据源？"></a>3. 如何对接其他的数据源？</h3><h3 id="4-如何对接其他的数据源？"><a href="#4-如何对接其他的数据源？" class="headerlink" title="4. 如何对接其他的数据源？"></a>4. 如何对接其他的数据源？</h3><h3 id="5-一次查询经历的流程？"><a href="#5-一次查询经历的流程？" class="headerlink" title="5. 一次查询经历的流程？"></a>5. 一次查询经历的流程？</h3><h3 id="6-初始化流程"><a href="#6-初始化流程" class="headerlink" title="6. 初始化流程?"></a>6. 初始化流程?</h3><h3 id="7-如何与spring对接？"><a href="#7-如何与spring对接？" class="headerlink" title="7. 如何与spring对接？"></a>7. 如何与spring对接？</h3><h3 id="8-如何优化性能？"><a href="#8-如何优化性能？" class="headerlink" title="8. 如何优化性能？"></a>8. 如何优化性能？</h3><h3 id="9-MappedStatement。"><a href="#9-MappedStatement。" class="headerlink" title="9. MappedStatement。"></a>9. MappedStatement。</h3>
          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/高并发/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/高并发/" class="post-title-link" itemprop="url">高并发场景和解决方案整理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:03:47" itemprop="dateCreated datePublished" datetime="2018-10-26T09:03:47+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:40:47" itemprop="dateModified" datetime="2019-07-21T00:40:47+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="解决高并发常用方案："><a href="#解决高并发常用方案：" class="headerlink" title="解决高并发常用方案："></a>解决高并发常用方案：</h2><p>方案一：使用内存操作代替实时的DB事物操作</p>
<p>优：提高了并发性能</p>
<p>缺：内存操作成功但是DB持久化失败，导致数据丢失，或者cache异常导致数据丢失</p>
<p>方案二：使用乐观锁代替悲观锁</p>
<p>优：提高DB并发处理能力</p>
<p>缺：只有第一个用户能够成功，其他的都会失败，用户失败后重试，产生大量的无效请求</p>
<p>方案三：微信红包解决高并发方案</p>
<ol>
<li><p>DB数据水平分割，系统垂直分割，一个<strong>垂直系列</strong>处理部分数据（id取模，落到一个set上）</p>
</li>
<li><p>逻辑Server层将请求排队，解决DB并发问题</p>
<ul>
<li>将同一个红包的请求通过idhash到同一个server处理，平均每一个server的请求</li>
<li>之后请求排队，解决DB并发问题</li>
<li>利用<strong>memcached的CAS</strong>原子累增操作，控制同时进入DB执行拆红包事务的请求数，超过预先设定数值则直接拒绝服务。用于DB负载升高时的降级体验，解决<strong>队列过载</strong></li>
</ul>
<ol start="3">
<li><p>双维度库表设计，保障系统性能稳定（红包数据的冷热分离–&gt;减低但表数据量）</p>
<blockquote>
<p>维度一：根据红包ID的hash值分为多库多表</p>
<p>维度二：分库表规则像db_xx.t_y_dd设计，xx/y是红包ID的hash值后三位，dd的取值范围在01~31</p>
</blockquote>
</li>
</ol>
</li>
</ol>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/HashMap/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/HashMap/" class="post-title-link" itemprop="url">HashMap要点</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:03:29" itemprop="dateCreated datePublished" datetime="2018-10-26T09:03:29+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:38:49" itemprop="dateModified" datetime="2019-07-21T00:38:49+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h3 id="synchronizedMap"><a href="#synchronizedMap" class="headerlink" title="synchronizedMap"></a>synchronizedMap</h3><p>为每个防范添加了synchronized</p>
<p>哈希表为解决冲突，可以采用开放地址法和链地址法等来解决问题</p>
<p>大小为2的幂次是为了取模和扩容（不需要重新计算hash）的效率</p>
<p>get：</p>
<p>计算数组位置地址，使用高位运算（hash值右移16）和取模（和n-1&amp;）</p>
<p>put：计算地址；是否存在key；是否treenode；是否超过8；是否超过threadhold</p>
<p>扩容：新数组（2倍），</p>
<p>循环中删除元素，需要使用迭代器，只能对每一个next（）当前元素做一次修改，否则异常，普通的循环会导致指向下一个元素的指针失效，报异常</p>
<p>arraylist的循环删除：</p>
<blockquote>
<p>foreach循环删除：删除后只能退出循环，否则异常</p>
<p>普通的循环会漏掉元素</p>
<p>iterator可以实现正常循环删除（Java8的Collection.remove(filter)是该方法的default实现，可以直接使用）</p>
</blockquote>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/设计模式/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/设计模式/" class="post-title-link" itemprop="url">设计模式--待整理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:03:05" itemprop="dateCreated datePublished" datetime="2018-10-26T09:03:05+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:45:21" itemprop="dateModified" datetime="2019-07-21T00:45:21+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p># </p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/RBTree/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/RBTree/" class="post-title-link" itemprop="url">数据结构--红黑树</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:02:53" itemprop="dateCreated datePublished" datetime="2018-10-26T09:02:53+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:59:19" itemprop="dateModified" datetime="2019-07-21T00:59:19+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><ul>
<li>著名的linux进程调度<a href="https://link.zhihu.com/?target=https%3A//en.wikipedia.org/wiki/Completely_Fair_Scheduler" target="_blank" rel="noopener">Completely Fair Scheduler</a>，用红黑树管理进程控制块</li>
<li>epoll在内核中的实现，用红黑树管理事件块</li>
<li>nginx中，用红黑树管理timer等</li>
<li>java的TreeMap实现</li>
</ul>
<p>二叉搜索树的搜索算法-&gt; RBTree 查询算法</p>
<h2 id="算法"><a href="#算法" class="headerlink" title="算法"></a>算法</h2><h3 id="properties-rules"><a href="#properties-rules" class="headerlink" title="properties-rules"></a>properties-rules</h3><ol>
<li>节点非红则黑</li>
<li>根节点是黑色，叶子节点全是null</li>
<li>红色节点的父节点和子节点都是黑色/红色节点的子节点全是黑色</li>
<li>从任意节点到叶子节点的黑色节点数目相同</li>
</ol>
<h3 id="修正"><a href="#修正" class="headerlink" title="修正"></a>修正</h3><ol>
<li>变色</li>
<li>左旋</li>
<li>右旋</li>
</ol>
<h3 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h3><p>​    如果是第一次插入，由于原树为空，所以只会违反红-黑树的规则2，所以只要把根节点涂黑即可；如果插入节点的父节点是黑色的，那不会违背红-黑树的规则，什么也不需要做。</p>
<p>如下三种情况需要做变色和旋转了：</p>
<ol>
<li>插入节点的父节点和父节点的兄弟节点是红色的</li>
<li>插入节点的父节点是红色的，父节点的兄弟节点是黑色的，父节点是祖父节点的右节点</li>
<li>插入节点的父节点是红色的，父节点的兄弟节点是黑色的，父节点是祖父节点的左节点</li>
</ol>
<p><strong>case 1：</strong></p>
<p>将父节点、父节点的兄弟节点、祖父节点变色，<strong>将当前节点指向祖父节点</strong>  —&gt; case2</p>
<p>*<em>case 2: *</em></p>
<p>以当前节点为支点进行左旋 —-&gt; case3</p>
<p>*<em>case 3: *</em></p>
<p>将当前节点的父节点、祖父节点变色，<strong>将当前节点指向祖父节点</strong>， 以当前节点为支点右旋</p>
<p>最后将根节点涂黑。</p>
<blockquote>
<p><strong>case 1 -&gt; case 2 -&gt; case 3</strong></p>
</blockquote>
<h3 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h3><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span><span class="params">(K key, V value)</span> </span>&#123;</span><br><span class="line">        Entry&lt;K,V&gt; t = root;</span><br><span class="line">        <span class="keyword">if</span> (t == <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">//如果根节点是null，直接添加为第一个节点</span></span><br><span class="line">            compare(key, key); <span class="comment">// type (and possibly null) check</span></span><br><span class="line">            root = <span class="keyword">new</span> Entry&lt;&gt;(key, value, <span class="keyword">null</span>);</span><br><span class="line">            size = <span class="number">1</span>;</span><br><span class="line">            modCount++;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> cmp;</span><br><span class="line">        Entry&lt;K,V&gt; parent;</span><br><span class="line">        <span class="comment">// split comparator and comparable paths</span></span><br><span class="line">        Comparator&lt;? <span class="keyword">super</span> K&gt; cpr = comparator;</span><br><span class="line">        <span class="keyword">if</span> (cpr != <span class="keyword">null</span>) &#123;</span><br><span class="line">          <span class="comment">//如果比较器不等于null，使用该比较器，否则使用默认比较器</span></span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                parent = t;</span><br><span class="line">                cmp = cpr.compare(key, t.key);</span><br><span class="line">                <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                    t = t.left;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                    t = t.right;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                  <span class="comment">//如果key等于当前节点（t），直接替换掉t，返回</span></span><br><span class="line">                    <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">            &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (key == <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">            <span class="meta">@SuppressWarnings</span>(<span class="string">"unchecked"</span>)</span><br><span class="line">                Comparable&lt;? <span class="keyword">super</span> K&gt; k = (Comparable&lt;? <span class="keyword">super</span> K&gt;) key;</span><br><span class="line">            <span class="keyword">do</span> &#123;</span><br><span class="line">                parent = t;</span><br><span class="line">                cmp = k.compareTo(t.key);</span><br><span class="line">                <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">                    t = t.left;</span><br><span class="line">                <span class="keyword">else</span> <span class="keyword">if</span> (cmp &gt; <span class="number">0</span>)</span><br><span class="line">                    t = t.right;</span><br><span class="line">                <span class="keyword">else</span></span><br><span class="line">                    <span class="keyword">return</span> t.setValue(value);</span><br><span class="line">            &#125; <span class="keyword">while</span> (t != <span class="keyword">null</span>);</span><br><span class="line">        &#125;</span><br><span class="line">  		<span class="comment">//插入新节点</span></span><br><span class="line">        Entry&lt;K,V&gt; e = <span class="keyword">new</span> Entry&lt;&gt;(key, value, parent);</span><br><span class="line">        <span class="keyword">if</span> (cmp &lt; <span class="number">0</span>)</span><br><span class="line">            parent.left = e;</span><br><span class="line">        <span class="keyword">else</span></span><br><span class="line">            parent.right = e;</span><br><span class="line">        fixAfterInsertion(e);</span><br><span class="line">        size++;</span><br><span class="line">        modCount++;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>如果有设置比较器，则可以添加key是null的节点，如果只有默认比较器，插入null节点会报<code>NullPointerException</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/** From CLR */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">fixAfterInsertion</span><span class="params">(Entry&lt;K,V&gt; x)</span> </span>&#123;</span><br><span class="line">      <span class="comment">//新节点初始默认颜色是red</span></span><br><span class="line">        x.color = RED;</span><br><span class="line">      <span class="comment">//x不是叶子节点，不是根节点，节点颜色是红色，均不满足</span></span><br><span class="line">        <span class="keyword">while</span> (x != <span class="keyword">null</span> &amp;&amp; x != root &amp;&amp; x.parent.color == RED) &#123;</span><br><span class="line">            <span class="keyword">if</span> (parentOf(x) == leftOf(parentOf(parentOf(x)))) &#123;</span><br><span class="line">                Entry&lt;K,V&gt; y = rightOf(parentOf(parentOf(x)));</span><br><span class="line">                <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(y, BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    x = parentOf(parentOf(x));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (x == rightOf(parentOf(x))) &#123;</span><br><span class="line">                        x = parentOf(x);</span><br><span class="line">                        rotateLeft(x);</span><br><span class="line">                    &#125;</span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    rotateRight(parentOf(parentOf(x)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                Entry&lt;K,V&gt; y = leftOf(parentOf(parentOf(x)));</span><br><span class="line">                <span class="keyword">if</span> (colorOf(y) == RED) &#123;</span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(y, BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    x = parentOf(parentOf(x));</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">if</span> (x == leftOf(parentOf(x))) &#123;</span><br><span class="line">                        x = parentOf(x);</span><br><span class="line">                        rotateRight(x);</span><br><span class="line">                    &#125;</span><br><span class="line">                    setColor(parentOf(x), BLACK);</span><br><span class="line">                    setColor(parentOf(parentOf(x)), RED);</span><br><span class="line">                    rotateLeft(parentOf(parentOf(x)));</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        root.color = BLACK;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p><code>Spliterator</code>：Java为了<strong>并行</strong>遍历数据源中的元素而设计的迭代器</p>
<p>对于<code>Spliterator</code>接口的设计思想，应该要提到的是Java7的Fork/Join(分支/合并)框架，总得来说就是用递归的方式把并行的任务拆分成更小的子任务，然后把每个子任务的结果合并起来生成整体结果。带着这个理解来看看<code>Spliterator</code>接口提供的方法</p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
      

  

  
  
  

  

  <article class="post post-type-normal" itemscope itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://dragonzho92.github.io/2018/10/26/网络基础架构/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="name" content="helon-zho">
      <meta itemprop="description" content="Insist on maintenance, start a new world">
      <meta itemprop="image" content="/images/avatar.gif">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Pointing into the distance">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">
                
                
                <a href="/2018/10/26/网络基础架构/" class="post-title-link" itemprop="url">网络基础架构--待整理</a>
              
            
          </h1>
        

        <div class="post-meta">

          
          
          

          
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">Posted on</span>
              

              
                
              

              <time title="Created: 2018-10-26 09:02:36" itemprop="dateCreated datePublished" datetime="2018-10-26T09:02:36+08:00">2018-10-26</time>
            </span>
          

          
            

            
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="fa fa-calendar-check-o"></i>
                </span>
                
                  <span class="post-meta-item-text">Edited on</span>
                
                <time title="Modified: 2019-07-21 00:45:30" itemprop="dateModified" datetime="2019-07-21T00:45:30+08:00">2019-07-21</time>
              </span>
            
          

          

          
            
            
          

          
          

          

          

          <br>
          

          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        
          
            <p># </p>

          
        
      
    </div>

    

    

    
    
    

    

    
      
    
    

    

    <footer class="post-footer">
      

      

      

      
      
        <div class="post-eof"></div>
      
    </footer>
  </div>
  
  
  
  </article>


    
  </section>

  
  <nav class="pagination">
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="extend next" rel="next" href="/page/2/"><i class="fa fa-angle-right" aria-label="Next page"></i></a>
  </nav>



          </div>
          

        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    <div class="sidebar-inner">

      

      

      <div class="site-overview-wrap sidebar-panel sidebar-panel-active">
        <div class="site-overview">

          <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
  
  <p class="site-author-name" itemprop="name">helon-zho</p>
  <div class="site-description motion-element" itemprop="description">Insist on maintenance, start a new world</div>
</div>


  <nav class="site-state motion-element">
    
      <div class="site-state-item site-state-posts">
        
          <a href="/archives/">
        
          <span class="site-state-item-count">12</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
    

    

    
  </nav>













          
          
        </div>
      </div>

      

      

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-user"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">helon-zho</span>

  

  
</div>


  <div class="powered-by">Powered by <a href="https://hexo.io" class="theme-link" rel="noopener" target="_blank">Hexo</a> v3.9.0</div>



  <span class="post-meta-divider">|</span>



  <div class="theme-info">Theme – <a href="https://theme-next.org" class="theme-link" rel="noopener" target="_blank">NexT.Gemini</a> v7.2.0</div>




        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
      </div>
    

    

    
  </div>

  

<script>
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>










  
  













  
  <script src="/lib/jquery/index.js?v=3.4.1"></script>

  
  <script src="/lib/velocity/velocity.min.js?v=1.2.1"></script>

  
  <script src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>




  <script src="/js/utils.js?v=7.2.0"></script>

  <script src="/js/motion.js?v=7.2.0"></script>



  
  


  <script src="/js/affix.js?v=7.2.0"></script>

  <script src="/js/schemes/pisces.js?v=7.2.0"></script>




  

  <script src="/js/next-boot.js?v=7.2.0"></script>

  

  

  

  

  

  

  

  

  



  




  




  




  






  

  

  


  

</body>
</html>
